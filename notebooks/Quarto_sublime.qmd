---
title: Grain Co Market entry dashboard
author: mhga94
format: 
    dashboard:
        scrolling: true
        theme: lux
server: shiny
jupyter: ironhack_final_env
---

```{python}
import plotly.express as px
import matplotlib.pyplot as plt
import pandas as pd 
import numpy as np 

# for price API
from urllib.request import urlopen
import certifi
import json

# Shiny
from shiny import App, ui, render
import shinywidgets
import mpld3

fmp_api_key = pd.read_table(r'../../FMP_api_key')
fmp_api_key = fmp_api_key['key'][0]

def get_jsonparsed_data(url):
    response = urlopen(url, cafile=certifi.where())
    data = response.read().decode("utf-8")
    return json.loads(data)

url = ("https://financialmodelingprep.com/api/v3/quote/KEUSX?apikey="+fmp_api_key)

keusx_dict = get_jsonparsed_data(url)

keusx_price = keusx_dict[0]['price']

# Top10 loading

top_10 = pd.read_csv(r'../data/Wheat_production_FAO.csv')
top_10 = top_10[['Area','Year','Value']]

# clean names
top_10['Area'][0] = "China"
top_10['Area'][2] = "Russia"
top_10['Area'][3] = "United States"

```

# Australia

## Row {height=10%}
![](attachment:99eebaf5-78ef-4113-9a09-05c91e9c4630.svg)

#| content: valuebox
#| title: "Wheat stock price"
#| icon: graph-up-arrow
#| color: primary
dict(value = keusx_price)

#| content: valuebox
#| title: "Global Wheat Production"
#| icon: globe-europe-africa
#| color: warning
# dict(value = keusx_price)
print("5th")

## Row {height=25%}

### Column {width=50%}

![](attachment:ca19cc92-0408-4697-a8a8-619a5c8fd08e.jpg)

### Column {width=50%}

#| content: valuebox
#| title: "Crop yield/hectare"
#| icon: graph-up-arrow
#| color: light
dict(value = keusx_price)

```{python}

container_df = pd.DataFrame(pd.read_csv(r'../data/container_port_traffic/API_IS.SHP.GOOD.TU_DS2_en_csv_v2_444204.csv', sep=","))

countries = top_10['Area']
container_2021 = []
for country in countries:
    i = container_df[container_df['Country Name']==country].index
    container_2021.append(str(container_df.loc[i, '2021']).split()[1])
container_2021[2] = 'NaN'
df_countries_totals = pd.DataFrame({'Country': countries, 'Total 2021': container_2021})

country_totals_dict = dict(zip(countries, container_2021))

```

#| content: valuebox
#| title: "Shipping containers per year (2021)"
#| icon: truck
#| color: light
dict(value = country_totals_dict['Australia'])

## Row {height=20%}

```{python}

wheat_prices = pd.read_csv(r'../data/wheat_prices_FAO.csv')

wheat_prices.columns = ['Date','United States of America (Gulf), Wheat (US No. 2, Hard Red Winter)',
'Argentina, Wheat (12%, Up River)',
'Australia (Eastern States), Wheat (ASW)',
'Canada (St Lawrence), Wheat (CWRS, 13.5%)',
'European Union (France), Wheat (grade 1, Rouen)',
'United States of America (Gulf), Wheat (US No. 2, Soft Red Winter)']

long_format_wp = pd.melt(wheat_prices, id_vars=['Date'], 
                         var_name='Country_Wheat_Type', 
                         value_name='Price')

sorted_wp = long_format_wp.sort_values(by = 'Date', ascending=False).reset_index(drop=True)

sorted_wp['Date'] = (pd.to_datetime(sorted_wp['Date'])).dt.date

resorted_wp = sorted_wp.sort_values(by='Date', ascending=False).reset_index(drop=True)

fig = px.line(resorted_wp, x = 'Date', y = 'Price', color = 'Country_Wheat_Type', title = 'Historic wheat prices')

fig = fig.update_layout(legend=dict(
        orientation="v",
        yanchor="bottom",
        y=0.5,
        xanchor="right",
        x=10,
        title_font_family="Courier",
            font=dict(
                family="Courier",
                size=14,
                color="black"
            ),
    ))

```